---
title: "scratch"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




```{r}

library(tidyverse)
library(lubridate)
library(timetk)
library(feasts)
library(tseries)

```


# Timetk

https://towardsdatascience.com/timetk-the-r-library-for-time-series-analysis-9822f7720318



# Bike Share

Attribute Information:

Both hour.csv and day.csv have the following fields, except hr which is not available in day.csv 

- instant: record index 
- dteday : date 
- season : season (1:winter, 2:spring, 3:summer, 4:fall) 
- yr : year (0: 2011, 1:2012) 
- mnth : month ( 1 to 12) 
- hr : hour (0 to 23) 
- holiday : weather day is holiday or not (extracted from [Web Link]) 
- weekday : day of the week 
- workingday : if day is neither weekend nor holiday is 1, otherwise is 0. 
+ weathersit : 
- 1: Clear, Few clouds, Partly cloudy, Partly cloudy 
- 2: Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist 
- 3: Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds 
- 4: Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog 
- temp : Normalized temperature in Celsius. The values are derived via (t-t_min)/(t_max-t_min), t_min=-8, t_max=+39 (only in hourly scale) 
- atemp: Normalized feeling temperature in Celsius. The values are derived via (t-t_min)/(t_max-t_min), t_min=-16, t_max=+50 (only in hourly scale) 
- hum: Normalized humidity. The values are divided to 100 (max) 
- windspeed: Normalized wind speed. The values are divided to 67 (max) 
- casual: count of casual users 
- registered: count of registered users 
- cnt: count of total rental bikes including both casual and registered 


```{r}

data(bike_sharing_daily)

bike_sharing_daily$ds <- bike_sharing_daily$dteday
bike_sharing_daily$y <- bike_sharing_daily$cnt

bike_sharing_daily %>%
  plot_time_series(ds, y, .interactive=TRUE, .plotly_slider=TRUE)



```



# Facets

```{r}

bike_sharing_daily %>%
	group_by(year(ds)) %>%
	plot_time_series(ds, y, .facet_scales="free")

bike_sharing_daily %>%
  group_by(year(ds)) %>%
  plot_time_series(ds, y, .facet_scales="free", .smooth=FALSE, .color_var=month(ds), .interactive=FALSE)


```


```{r}

bike_sharing_daily %>%
  group_by(year(ds)) %>%
  plot_seasonal_diagnostics(ds, y, .x_lab='Date', .y_lab='# of users', .title='Bike Sharing Users')


```


```{r}

# Get the data
bike_sharing_daily %>%
  group_by(year(ds)) %>%
  plot_anomaly_diagnostics(ds, y)

```


```{r}

anomaly_data <- bike_sharing_daily %>%
	group_by(year(ds)) %>%
	tk_anomaly_diagnostics(ds, y) %>%
	filter(anomaly == 'Yes')

anomaly_data

```















































# ACF and PACF

```{r}

bike_sharing_ts <- bike_sharing_daily %>% 
	tsibble::as_tsibble(index = ds)

bike_sharing_ts %>% select(ds,y) %>%
	acf(plot = T, main = "ACF Plot of CPI", xaxt="n")

bike_sharing_ts %>% select(ds,y) %>%
	pacf(plot = T, main = "ACF Plot of CPI", xaxt="n")

```






```{r}

bike_sharing_ts %>% select(ds,y) %>% gg_season(y)
bike_sharing_ts %>% select(ds,y) %>% gg_subseries(y)
bike_sharing_ts %>% select(ds,y) %>% gg_lag(y)
bike_sharing_ts %>% select(ds,y) %>% ACF(y) %>% autoplot()

dcmp <- bike_sharing_ts %>%
  model(STL(y ~ season(window = Inf)))

components(dcmp) %>% autoplot()

```




```{r}

lag.length = 12
Box.test(bike_sharing_ts$y, lag=lag.length, type="Ljung-Box") # test stationary signal
kpss.test(bike_sharing_ts$y, null="Trend")
adf.test(bike_sharing_ts$y)

```






# Prophet


```{r}



```




	
